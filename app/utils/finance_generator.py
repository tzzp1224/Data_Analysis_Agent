# æ–‡ä»¶è·¯å¾„: app/utils/finance_generator.py
import pandas as pd
import os

def create_reconciliation_data(data_dir: str = "data"):
    """
    ç”Ÿæˆä¸“é—¨ç”¨äºæµ‹è¯•â€œè´¢åŠ¡å¯¹è´¦â€çš„é«˜éš¾åº¦æ•°æ®ã€‚
    åŒ…å«ï¼šå¤šå¯¹ä¸€ã€æ—¶é—´å·®ã€é‡‘é¢å®¹å·®ã€å•è¾¹è´¦ã€‚
    """
    os.makedirs(data_dir, exist_ok=True)

    # ==========================================
    # 1. ç³»ç»Ÿæ—¥è®°è´¦ (System Ledger) - æ˜ç»†æ•°æ®
    # ==========================================
    # åœºæ™¯ï¼š
    # - å¤–éƒ¨æµæ°´å· TRX-100: å¯¹åº” 3 ç¬”è®¢å• (300+300+400=1000) -> æµ‹è¯•å¤šå¯¹ä¸€
    # - å¤–éƒ¨æµæ°´å· TRX-101: æ­£å¸¸ (500) -> æµ‹è¯•å®Œå…¨åŒ¹é…
    # - å¤–éƒ¨æµæ°´å· TRX-102: é‡‘é¢ 1000 -> æµ‹è¯•å®¹å·®åŒ¹é… (é“¶è¡Œæ‰£äº†5å…ƒ)
    # - å¤–éƒ¨æµæ°´å· TRX-999: ç³»ç»Ÿæœ‰ï¼Œé“¶è¡Œæ—  -> æµ‹è¯•ç³»ç»Ÿå•è¾¹è´¦
    sys_data = [
        {"è®¢å•å·": "ORD-001", "å¤–éƒ¨æµæ°´å·": "TRX-100", "åº”æ”¶é‡‘é¢": 300.00, "è®°è´¦æ—¥æœŸ": "2024-01-01", "æ‘˜è¦": "æœåŠ¡è´¹ç¬¬ä¸€æœŸ"},
        {"è®¢å•å·": "ORD-002", "å¤–éƒ¨æµæ°´å·": "TRX-100", "åº”æ”¶é‡‘é¢": 300.00, "è®°è´¦æ—¥æœŸ": "2024-01-01", "æ‘˜è¦": "æœåŠ¡è´¹ç¬¬äºŒæœŸ"},
        {"è®¢å•å·": "ORD-003", "å¤–éƒ¨æµæ°´å·": "TRX-100", "åº”æ”¶é‡‘é¢": 400.00, "è®°è´¦æ—¥æœŸ": "2024-01-01", "æ‘˜è¦": "æœåŠ¡è´¹å°¾æ¬¾"}, 
        
        {"è®¢å•å·": "ORD-004", "å¤–éƒ¨æµæ°´å·": "TRX-101", "åº”æ”¶é‡‘é¢": 500.00, "è®°è´¦æ—¥æœŸ": "2024-01-02", "æ‘˜è¦": "æ ‡å‡†è®¢é˜…"},
        
        {"è®¢å•å·": "ORD-005", "å¤–éƒ¨æµæ°´å·": "TRX-102", "åº”æ”¶é‡‘é¢": 1000.00, "è®°è´¦æ—¥æœŸ": "2024-01-03", "æ‘˜è¦": "å¤§é¢å……å€¼"},
        
        {"è®¢å•å·": "ORD-006", "å¤–éƒ¨æµæ°´å·": "TRX-999", "åº”æ”¶é‡‘é¢": 888.00, "è®°è´¦æ—¥æœŸ": "2024-01-05", "æ‘˜è¦": "ç³»ç»Ÿè¯¯å½•"},
    ]
    df_sys = pd.DataFrame(sys_data)
    path_sys = os.path.join(data_dir, "ç³»ç»Ÿæ—¥è®°è´¦.xlsx")
    df_sys.to_excel(path_sys, index=False)

    # ==========================================
    # 2. é“¶è¡Œæµæ°´ (Bank Statement) - æ±‡æ€»æ•°æ®
    # ==========================================
    # åœºæ™¯ï¼š
    # - TRX-100: é‡‘é¢ 1000ï¼Œæ—¥æœŸæ™šäº†1å¤© -> æµ‹è¯•æ—¶é—´å·®
    # - TRX-102: é‡‘é¢ 995 (å°‘äº†5å—) -> æµ‹è¯• Tolerance
    # - TRX-UNKNOWN: é“¶è¡Œæœ‰ï¼Œç³»ç»Ÿæ—  -> æµ‹è¯•é“¶è¡Œå•è¾¹è´¦
    bank_data = [
        {"äº¤æ˜“æµæ°´": "TRX-100", "åˆ°è´¦é‡‘é¢": 1000.00, "åˆ°è´¦æ—¥æœŸ": "2024-01-02", "å¯¹æ–¹æˆ·å": "å¼ ä¸‰ç§‘æŠ€"},
        {"äº¤æ˜“æµæ°´": "TRX-101", "åˆ°è´¦é‡‘é¢": 500.00,  "åˆ°è´¦æ—¥æœŸ": "2024-01-02", "å¯¹æ–¹æˆ·å": "æå››ç½‘ç»œ"},
        {"äº¤æ˜“æµæ°´": "TRX-102", "åˆ°è´¦é‡‘é¢": 995.00,  "åˆ°è´¦æ—¥æœŸ": "2024-01-03", "å¯¹æ–¹æˆ·å": "ç‹äº”é›†å›¢"}, # æ‰‹ç»­è´¹å·®å¼‚
        {"äº¤æ˜“æµæ°´": "TRX-UNKNOWN", "åˆ°è´¦é‡‘é¢": 200.00, "åˆ°è´¦æ—¥æœŸ": "2024-01-06", "å¯¹æ–¹æˆ·å": "æœªçŸ¥å®¢æˆ·"},
    ]
    df_bank = pd.DataFrame(bank_data)
    path_bank = os.path.join(data_dir, "é“¶è¡Œæµæ°´.xlsx")
    df_bank.to_excel(path_bank, index=False)

    print(f"ğŸ’° [Finance Generator] å·²ç”Ÿæˆå¯¹è´¦æµ‹è¯•æ•°æ®:")
    print(f"  - {path_sys}")
    print(f"  - {path_bank}")
    return [path_sys, path_bank]

if __name__ == "__main__":
    create_reconciliation_data()